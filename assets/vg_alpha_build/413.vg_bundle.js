"use strict";(self.webpackChunkcustom_vf_nextjs=self.webpackChunkcustom_vf_nextjs||[]).push([[413],{1413:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var a=n(15861),s=n(70885),u=n(64687),r=n.n(u),o=n(48676),c=n(91148),l=n(59748),d=n(45392),i=n(83260),f=n(30381),v=n.n(f),p=l.default.createElement;const g=function(e){var t=(0,o.useRuntime)(),n=t.confirmedBucket,u=t.runtime,f=l.default.useState(""),g=(0,s.Z)(f,2),m=g[0],x=g[1],b=l.default.useState(!1),k=(0,s.Z)(b,2),I=k[0],y=k[1];return l.default.useEffect((function(){if(m)y(!0);else{var t=new WebSocket("".concat((0,c.IO)({region:"voiceglow-eu"===n?"eu":"na"}),"/flowise")),s="";t.onopen=function(){var c;t.send(JSON.stringify({agentId:u.variables.ID,convoId:u.userID,flowisePayload:null===(c=e.message)||void 0===c||null===(c=c.item)||void 0===c?void 0:c.payload,bucket:n})),t.onmessage=function(e){try{var t,n=JSON.parse(e.data);"chunk"===n.type&&null!=n&&null!==(t=n.payload)&&void 0!==t&&t.chunk&&(x((function(e){return e+n.payload.chunk})),s+=n.payload.chunk)}catch(e){}},t.onclose=(0,a.Z)(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,s){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,(0,o.handlePushMessageNoInteract)({agentID:u.variables.ID,userID:u.userID,action:null,origin:"web-chat",messages:[{type:"text",item:{payload:{message:s}},ts:v()().unix(),from:"bot",mask:{turnIndex:e.turnIndex,messageIndex:e.messageIndex}}],bucket:n,vf_variables:{flowise_response:s}});case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))}}}),[]),m&&!I?p(i.Z,{className:" vg-p-6 vg-rounded-tl-[25px] vg-rounded-bl-[25px] vg-rounded-tr-[25px] vg-rounded-br-[5px] vg-justify-self-end vg-message-text-bot",item:{type:"text",payload:{message:""},ts:v()().unix(),from:"bot"},text:m,key:"flowise_res_".concat(e.turnIndex,"_").concat(e.messageIndex)}):I?null:p(d.default,{variant:"no-avatar"})}}}]);